<style>
em {
	background-color:yellow;
	font-style:normal;
}
fieldset {
	line-height:200%;
}
fieldset input,fieldset select{
	float:right;
}
fieldset label{
	float:left;
}
td.editing input{
	padding:0;
}
</style>
<p class="page_title_text">{$ACTION_TITLE}</p>
<table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:#FFFFFF;">
<tr>
	<td width="10">&nbsp;</td>
	<td width="250" valign="top">
		<form action="__URL__/create" method="post" target="_iframe">
		<fieldset>
			<legend>Create New Form</legend>
			<input type="text" id="name" name="name" value="{$new_name}" size="16"/><label for="name">Test No.</label>
			<div class="clear"></div>
			<input type="text" id="project" name="project" value="" size="16" /><label for="project">Project ID</label>
			<div class="clear"></div>
			<input type="text" id="sw_version" name="sw_version" size="16" /><label for="sw_version">SW Version</label>
			<div class="clear"></div>
			<input type="text" id="release" name="release_date" size="16" /><label for="release">Release Date</label>
			<div class="clear"></div>
			<input type="submit" name="submit" value="Create" />
		</fieldset>
		</form>

		<form action="__URL__/index" method="get">
		<fieldset>
			<legend>Search by keywords</legend>
			<input type="text" id="sname" name="name" size="16" value="{$request['name']}" /><label for="sname">Test NO.</label>
			<div class="clear"></div>
			<select id="staff_id" name="staff_id"><option value="">All</option>{$staff_opts}</select><label for="staff_id">Creator</label>
			<div class="clear"></div>
			<input type="text" id="sproject" name="project" size="16" value="{$request['project']}" /><label for="sproject">Project ID</label>
			<div class="clear"></div>
			<input type="text" id="sversion" name="sw_version" size="16" value="{$request['sw_version']}" /><label for="sversion">SW Version</label>
			<div class="clear"></div>
			<input type="text" id="string" name="string" size="16" value="{$request['string']}" /><label for="string">Keyword</label>
			<div class="clear"></div>
			<input type="button" onclick="window.location='__URL__';" value="Reset" />
			<input type="submit" value="Search" />
		</fieldset>
		</form>
		<br />
		<small style="font-size:9pt;">
		Tips: For green table cells, "Mouse Click" to edit, "Enter" to save, "Esc" to cancel.
		</small>
	</td>
	<td width="10">&nbsp;</td>
	<td valign="top">
		{$page}
		<iterate name="result" id="item">
			<php>if ($item['staff_id'] == $_SESSION[C('USER_AUTH_KEY')])$editable = true;</php>
		<form id="form{$item['id']}" action="__URL__/edit" method="post" target="_iframe">
		<input type="hidden" name="id" value="{$item['id']}" />
		<table cellpadding="0" cellspacing="0" style="border:1px solid #999999;margin:5px 10px;">
		<tr>
			<td>
				<table id="{$item['id']}" class="header" width="100%" cellpadding="5" cellspacing="0" border="1" bordercolor="#999999" style="border-collapse:collapse;background-color:#FFFFFF;">
				<tr>
					<th style="text-align:left">Test NO.</th>
					<empty name="editable">
					<td>{$item['name']}</td>
					<else />
					<td class="header"><span>{$item['name']}</span><input type="text" name="name" value="{$item['name']|str_replace=array('<em>','</em>'),'',###}" style="display:none;width:0;" /></td>
					</empty>
					<th style="text-align:left">Create Time</th>
					<td>{$item['create_time']}</td>
				</tr>
				<tr>
					<th style="text-align:left">Creator</th>
					<td>{$item['staff']['realname']}</td>
					<th style="text-align:left">Project ID</th>
					<empty name="editable">
					<td>{$item['project']}</td>
					<else />
					<td class="header"><span>{$item['project']}</span><input type="text" name="project" value="{$item['project']|str_replace=array('<em>','</em>'),'',###}" style="display:none;width:0;" /></td>
					</empty>
				</tr>
				<tr>
					<th style="text-align:left;">SW Version</th>
					<empty name="editable">
					<td>{$item['sw_version']}</td>
					<else />
					<td class="header"><span>{$item['sw_version']}</span><input type="text" name="sw_version" value="{$item['sw_version']|str_replace=array('<em>','</em>'),'',###}" style="display:none;width:0;" /></td>
					</empty>
					<th style="text-align:left;">Release Date</th>
					<empty name="editable">
					<td>{$item['release_date']}</td>
					<else />
					<td class="header"><span>{$item['release_date']}</span><input type="text" name="release_date" value="{$item['release_date']|str_replace=array('<em>','</em>'),'',###}" style="display:none;width:0;" /></td>
					</empty>
				</table>
			</td>
		</tr>
		<tr>
			<td>
				<table id="{$item['id']}" class="entry" width="100%" cellpadding="3" cellspacing="0" border="1" bordercolor="#999999" style="border-collapse:collapse;background-color:#FFFFFF;">
				<tr>
					<td>&nbsp;</td>
					<foreach name="x_axis" item="x">
					<th>{$x}</th>
					</foreach>
				</tr>
					<iterate name="item.entry" id="row">
					<php>$y = $key;</php>
				<tr>
					<th>{$y}</th>
						<foreach name="x_axis" item="x">
							<empty name="editable">
					<td>{$row[$x]['string']|default='&nbsp;'}</td>
							<else />
					<td class="entry">
							<empty name="row[$x]">
						<span></span><input type="text" name="entry[{$x}][{$y}]" value="" style="display:none;width:0;" />
							<else />
						<span>{$row[$x]['string']}</span><input type="text" name="entry[{$row[$x]['id']}]" value="{$row[$x]['string']|str_replace=array('<em>','</em>'),'',###}" style="display:none;width:0;" />
							</empty>
					</td>
							</empty>
						</foreach>
				</tr>
					</iterate>
				</table>
			</td>
		</tr>
		</table>
		</form>
		</iterate>
		{$page}
		<empty name="result">
		<p class="center">No Record</p>
		<else />
		<p class="center">&nbsp;</p>
		</empty>
	</td>
</tr>
</table>
<script language="JavaScript" type="text/javascript">
$(document).ready(function(){
	$("td.header, td.entry").each(function() {
		setEditable(this);
	});
});
window.onbeforeunload = function() {
	if (!has_submit && $('td.editing').length>0) {
		return 'Last form hasn\'t been saved, continue?';
	}
}
var last_id = 0;
var last_obj = 0;
var has_submit = false;
function setEditable(obj) {
	$(obj).css('cursor', 'pointer').mouseover(function(){
		$(this).addClass("focus");
	}).mouseout(function(){
		$(this).removeClass("focus");
	}).click(function(){
		var curr_id = parseInt($(this).parent().parent().parent().attr('id'));
	//	alert(curr_id+','+last_id);
		if (last_id!=0 && last_id!=curr_id) {
			if (confirm('Last form hasn\'t been saved, continue?')) {
				$("td.editing").each(function() {
					$(this).children('input').hide();
					$(this).children('span').show();
					$(this).removeClass('editing');
				});
			}
			else {
				$(last_obj).children("input").focus();
				return;
			}
		}
		if ($(this).children('input').css('display') != 'none') {
			return;
		}
	//	$("td.editing").children('input').hide();
	//	$("td.editing").children('span').show();
	//	$("td.editing").removeClass('editing');
		var width = $(this).width();
		$(this).children('span').hide();
		$(this).children("input").css('width', width).show().select().keydown(function(e){
			var keyCode=e.keyCode || window.event.keyCode;
			if(keyCode==13)
			{
				has_submit = true;
				$("#form"+curr_id).submit();
			}
			else if(keyCode==27)
			{
				cancel_edit(this);
			}
		});
		$(this).addClass('editing');
		last_id = curr_id;
		last_obj = this;
	});
}
function submit_edit(obj){
	$("#_iframe").attr('src', '__URL__/edit/submit/1/id/'+$(obj).attr('id')+'/bundle_id/'+$(obj).attr('class')+'/name/'+$(obj).attr('name')+'/f/string/v/'+$(obj).val());
}
function cancel_edit(obj){
	$(obj).hide().prev().show();
}
function changeResult(obj) {
	$("#_iframe").attr('src', '__URL__/update/id/'+$(obj).parent().attr('id')+'/f/result/v/'+$(obj).attr('id'));
}
</script> 