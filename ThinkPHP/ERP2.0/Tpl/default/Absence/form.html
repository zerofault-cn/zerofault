<style>
#think_run_time,#think_page_trace{display:none;}
</style>
<table width="100%">
<tr>
	<td class="clsTab current" id="leave">New leave application</td>
	<td class="clsTab" id="out">Out of office request</td>
</tr>
<tr>
	<td colspan="2">
		<form action="__URL__/submit" method="post" target="_iframe" enctype="multipart/form-data">
		<table class="clsTab" id="leave" width="100%" border="1" cellpadding="3" cellspacing="1" bordercolor="#FFFFFF" style="border-collapse:collapse;">
		<tr>
			<th colspan="3">Leave application form</th>
		</tr>
		<tr bgcolor="#CCCCCC" align="center">
			<td width="25%">Applicant</td>
			<td width="25%">Creator</td>
			<td>Type</td>
		</tr>
		<tr bgcolor="#EEEEEE" align="center">
			<td>{$_SESSION[C('STAFF_AUTH_NAME')]['realname']}</td>
			<td>{$_SESSION[C('STAFF_AUTH_NAME')]['realname']}</td>
			<td>
				<select name="type" onchange="ChangeType(this.value);" alt="Absence type" title="Select absence type">
					<option value="">---------Select---------</option>
					<iterate name="LeaveType" id="item">
					<option value="{$item['type']}">{$item['name']}</option> 
					</iterate>
				</select>
				<div id="div_absTypeERROR"></div>
			</td>
		</tr>
		<tr bgcolor="#CCCCCC" align="center">
			<td>Hours</td>
			<td colspan="2">Duration&nbsp;&nbsp;&nbsp;&nbsp;
			[<a href='javascript:void(0);' onclick="quickSelectDate(1, 'todayDate', 'A')" title="Change duration date to today">Today</a> | <a href='javascript:void(0);' onclick="quickSelectDate(2, 'todayDate', 'A')" title="Change duration date to today AM half day">AM</a> | <a href='javascript:void(0);' onclick="quickSelectDate(3, 'todayDate', 'A')" title="Change duration date to today PM half day">PM</a>]&nbsp;/&nbsp;[<a href='javascript:void(0);' onclick="quickSelectDate(1, 'tomorrowDate', 'A')" title="Change duration date to tomorrow">Tomorrow</a> | <a href='javascript:void(0);' onclick="quickSelectDate(2, 'tomorrowDate', 'A')" title="Change duration date to tomorrow AM half day">AM</a> | <a href='javascript:void(0);' onclick="quickSelectDate(3, 'tomorrowDate', 'A')" title="Change duration date to tomorrow PM half day">PM</a>]</td>
		</tr>
		<tr bgcolor="#EEEEEE" align="center">
			<td><input type="text" name="totalHours" id="totalHours" value="8" size="2" alt="Total absence hours" title="Click to edit total absence hours"> hrs<div id="div_typeNotice_hour"></div></td>
			<td align="center" colspan="2">
				<input name="date_from" type="text" id="date_from" value="{$date_from}" size="12" disabled="disabled" alt="Absence start date" title="Click to choose absence start date" />
				<input type="text" size="5" value="{$time_from}" name="time_from" id="time_from" disabled="disabled" alt="Absence start time" title="Input absence start time" />&nbsp;~&nbsp;
				<input name="date_to" type="text" id="date_to" value="{$date_to}" size="12" disabled="disabled" alt="Absence end date" title="Click to choose absence end date"  />
				<input type="text" size="5" name="time_to" id="time_to" value="{$time_to}" disabled="disabled" alt="Absence end time" title="Input absence end time" />
			</td>
		</tr>
		<tr bgcolor="#CCCCCC" align="center">
			<td>Deputy</td>
			<td colspan="2">Attached File</td>
		</tr>
		<tr bgcolor="#EEEEEE" align="center">
			<td>
				<select name="deputy">
				<option value="">----Select----</option>
				<foreach name="DeptStaff" key="dept" item="Staff">
					<optgroup label="{$dept}">
					<foreach name="Staff" item="staff" key="j">
						<neq name="staff['id']" value="$_SESSION[C('STAFF_AUTH_NAME')]['id']">
							<if condition="$j eq 0">
						<option value="{$staff['id']}" style="background-color:#FABF8F;">{$staff['realname']}</option>
							<else />
						<option value="{$staff['id']}">{$staff['realname']}</option>
							</if>
						</neq>
					</foreach>
					</optgroup>
				</foreach>
				</select>
			</td>
			<td align="center" colspan="2">
				<input id="file" type="file" name="file[]" size="30" style="display:none;"/>&nbsp;<img style="cursor: pointer;" src="../Public/Images/attachfile.gif" onclick="addFile(this);" align="absmiddle"></td>
		</tr>
		<tr bgcolor="#CCCCCC" align="center">
			<td>Notifiable users</td>
			<td colspan="2">Reason</td>
		</tr>
		<tr bgcolor="#EEEEEE" align="center">
			<td valign="top">
				<dl>
				<foreach name="Notification" key="name" item="email">
					<dt><input type="checkbox" name="notification[]" value="{$email}" checked="checked"/> {$name}</dt>
				</foreach>
				</dl>
				<select id="notification" name="notification[]" style="display:none;">
				<option value="">----Select----</option>
				<foreach name="DeptStaff" key="dept" item="Staff">
					<optgroup label="{$dept}">
					<foreach name="Staff" item="staff" key="j">
						<if condition="in_array($staff['email'], $Notification) neq true and $staff['id'] neq $_SESSION[C('STAFF_AUTH_NAME')]['id']">
							<if condition="$j eq 0">
						<option value="{$staff['email']}" style="background-color:#FABF8F;">{$staff['realname']}</option>
							<else />
						<option value="{$staff['email']}">{$staff['realname']}</option>
							</if>
						</if>
					</foreach>
					</optgroup>
				</foreach>
				</select><img src="../Public/Images/add_member.gif" onclick="addNotify(this);" width="25" height="25" align="absmiddle" style="cursor: pointer;" title="Click to show user selection" />
			</td>
			<td colspan="2"><textarea id="reason" name="reason" cols="50" rows="5" alt="Absence reason" title="Click to edit absence reason" ></textarea></td>
		</tr>
		</table>
		<table class="clsTab" style="border-collapse:collapse;display:none" id="out">
		<tr>
			<td>Out of office</td>
		</tr>
		</table>
		<div id="div_form_notice"></div>
		<p class="center">
			<input type="submit" name="submit" value="Submit" title="Submit this absence apply form" />&nbsp;&nbsp;&nbsp;<input type="button" value="Cancel" onclick="self.parent.tb_remove()" alt="Cancel" title="Click to go previous page" />
		</p>
		<div align="left" id="div_typeRule" style="color:red;"></div>
		</form>
	</td>
</table>
<!-- Datepicker -->
<style type="text/css">@import "../Public/Css/jquery-ui-1.8.2.custom.css?20100620";</style> 
<script type="text/javascript" src="../Public/Js/jquery-ui-1.8.2.custom.min.js?20100620"></script>
<script language="JavaScript" type="text/javascript">
$(document).ready(function(){
	var uidates = $('#date_from, #date_to').datepicker({
		dateFormat: 'yy-mm-dd',
		changeMonth: true,
		changeYear: true,
		showOtherMonths: true,
		showMonthAfterYear: true,
		selectOtherMonths: true,
		minDate: '{$date_from}',
		maxDate: '+1Y',
		onSelect: function(selectedDate) {
			var option = this.id == "date_from" ? "minDate" : "maxDate";
			var instance = $(this).data("datepicker");
			var date = $.datepicker.parseDate(instance.settings.dateFormat || $.datepicker._defaults.dateFormat, selectedDate, instance.settings);
			uidates.not(this).datepicker("option", option, date);
		},
	});
	$("td.clsTab").each(function(){
		$(this).css("cursor", "pointer").click(function(){
			switchTab($(this).attr("id"));
		});
	});
//	$('#btn_submitla').bind('click', CheckForm_absenceApply);});
});

var descr_arr = new Array();
<iterate name="LeaveType" id="item">
descr_arr['{$item["type"]}'] = '{$item["description"]}';
</iterate>
function ChangeType(type) {
	if (type!='') {
		$('#date_from, #time_from, #date_to, #time_to').attr('disabled', false);
		$('#div_typeRule').html(descr_arr[type]);
	}
}
function addFile(obj) {
	if ($('#file').css('display')=='none') {
		$('#file').show();
	}
	else {
		$(obj).before('<img src="../Public/Images/attachfile.gif" align="absmiddle" style="visibility:hidden;"><br /><input type="file" name="file[]" size="30" />&nbsp;');
	}
}
function addNotify(obj) {
	if ($('#notification').css('display')=='none') {
		$('#notification').show();
	}
	else {
		var html = '<br /><select name="notification[]">';
		html += $('#notification').html();
		html += '</select> ';
		$(obj).before(html);
	}
}

</script>